/* ======================================================================================
   @MODULES -> STORES / MAPS
   ====================================================================================== */

/*
	Usage:
		'Stores' section of the site, layout for both listing and detail views and any other 'Stores' specific styling.

  Notes:
    Modules that live here:
    -  Store listings
    -  Storefront
    -  Micello maps

	Demo:
		Style Guide -> Modules -> Stores / Maps
*/

.stores-maps {
  position: absolute;
  z-index: 2;
  @include to-rem(top, 88);
  bottom: 0;
  left: 0;
  right: 0;

  /* Increase top positioning at this breakpoint */
  @include respond-min($non-palm) {
    @include to-rem(top, 110);
  }

  /* Turn off `.container` rules at this breakpoint */
  @include respond-max($ipad-landscape - 1) {
    &.container {
      width: auto;
      max-width: none;
    }
  }

  /* Non JS users */
  .no-js & {position: static;}

  /* --Global rules-- */
  p {margin-bottom: 0;}

  /* Location icon */
  .icon--pin:before {
    color: $color-brand;
    @include font-size(28, 1);
  }
}

  /* --Shared rules-- */

  /* Outdent the pin icons so they're flush to left edge */
  .stores-list__store-name .icon--pin:before,
  .stores-maps__filters-count .icon--pin:before {@include to-rem(margin-left, -4);}

  /* Listing and detail views container */
  .stores-maps__inner {
    position: absolute;
    z-index: 4;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;

    /* Half the width at this breakpoint */
    @include respond-min($ipad-landscape) {
      width: 50%;
    }

    /* Turn off absolute positioning for 'detail view' at this breakpoint */
    @include respond-max($ipad-landscape - 1) {
      &.stores-maps__inner--detail {position: static;}
    }

    /* When map view is in view */
    .is-map-view & {
      position: static;

      /* Back to absolute positioning at this breakpoint */
      @include respond-min($ipad-landscape) {
        position: absolute;
      }
    }

    /* Non JS users */
    .no-js & {position: static;}
  }

    /* Filters / toggle */
    .stores-maps__filters-toggle {
      background-color: $color-grey-3;
      border-bottom: 1px solid $color-grey-1;
      position: relative;
      z-index: 6;

      /* Hide for detail view */
      .stores-maps__inner--detail & {
        display: none;

        .is-map-view & {display: block;}
      }

      /* When map view is in view */
      @include respond-max($palm) {
        .is-map-view & {
          background: none;
          border: 0;
          pointer-events: none;

          /* Make nested elements clickable */
          .drop-down-menu *,
          .stores-maps__toggle {pointer-events: auto;}
        }
      }

      /* Apply box treatments at this breakpoint */
      @include respond-min($ipad-landscape) {
        border: 0;
        @include box;
        @include box-heavy;
        @include to-rem(margin-bottom margin-top, $spacing-base);

        /* Show for detail view */
        .stores-maps__inner--detail & {display: block;}
      }

      /* Inner container */
      .container {
        /* Temp style so current feature can be released */
        text-align: right;
        position: relative;
        @include to-rem(padding-top padding-bottom, $spacing-half);
        @extend %clear-fix;

        /* Increase padding at this breakpoint */
        @include respond-min($non-palm) {
          @include to-rem(padding-top padding-bottom, $spacing-half+$spacing-quarter);
        }

        /* Temp style so current feature can be released */
        @include respond-min($ipad-landscape) {
          text-align: left;
        }
      }

        /* Filter drop down */
        .drop-down-menu {

          /* Need to float left at this breakpoint range */
          @include respond-range($non-palm, $ipad-landscape - 1) {
            float: left;
          }

          /* Increase right padding for trigger at this breakpoint */
          @include respond-min($non-palm) {
            .drop-down-menu__trigger {@include to-em(padding-right, $spacing-dbl+$spacing-base);}
          }
        }
    }

      /* Header */
      .stores-maps__filters-toggle__hdr {
        display: block;
        font-family: $font-family-opensans;
        @include font-size(24, 1.5);
        color: $color-dark-txt;
        @include to-em(margin-bottom, $spacing-third);
        /* Temp style so current feature can be released */
        margin-bottom: 0;

        /* Detail view */
        .stores-maps__inner--detail & {
          margin-bottom: 0;

          .icon:before {
            top: -2px;

            /* IE 10/9 fixes */
            @include ie-10-up {
              top: 0;
            }
            .ie-9 & {top: 0;}
          }
        }

        /* Hide the header at this breakpoint */
        @include respond-max($ipad-landscape - 1) {
          @include hide-visually;

          /* When map view is in view */
          .is-map-view & {display: none;}
        }

          > span {color: $color-light-txt;}
      }

          /* Reapply global link hover to first child `span` */
          a.stores-maps__filters-toggle__hdr:hover > span,
          a.stores-maps__filters-toggle__hdr:focus > span {color: $color-link-hover;}

      /* Toggle button */
      .stores-maps__toggle {
        /* Temp removal so current feature can be released */
        /*@include respond-max($palm) {
          position: absolute;
          right: 0;
          top: 50%;
          @include translate(0, -50%);
        }*/

        /* Reveal button text, float right and fix a width at this breakpoint */
        @include respond-min($non-palm) {
          float: right;
          @include to-rem(min-width, 116);

          /* Link version */
          &.stores-maps__toggle--link {@include to-rem(min-width, 106);}

          /* Reveal button text */
          .hide-visually {@include hide-visually-off;}
        }

        /* Hide at this breakpoint */
        @include respond-min($ipad-landscape) {
          &.btn {display: none;}
        }

        /* Non JS users */
        .no-js & {display: none;}

          /* Left spacing for icon at this breakpoint */
          @include respond-min($non-palm) {
            .icon {@include to-rem(margin-left, $spacing-base);}
          }

          /* Hide/show icons */
          .icon--list {display: none;}

          /* When map view is in view */
          .is-map-view & {
            .icon--map2 {display: none;}
            .icon--list {display: inline-block;}
          }
      }

      /* Post filter count */
      .stores-maps__filters-count {
        @include font-size($font-size-sml, 1.5);
        border-top: 1px solid $color-grey-1;

        /* Inner container */
        .container {
          @include to-rem(padding-top padding-bottom, $spacing-micro);

          /* Increase padding at this breakpoint */
          @include respond-min($non-palm) {
            @include to-rem(padding-top padding-bottom, $spacing-sixth);
          }
        }
      }

    /* List / Detail views */
    .stores-maps__list-detail {
      position: absolute;
      z-index: 5;
      @include to-rem(top, 56);
      bottom: 0;
      left: 0;
      right: 0;
      overflow-y: auto;

      /* Post filter count */
      .is-filter-applied & {@include to-rem(top, 88);}

      /* iOS/Android */
      .ios &,
      .android & {
        overflow-y: scroll;
        -webkit-overflow-scrolling: touch;
      }

      /* When map view is in view */
      .is-map-view & {
        display: none;

        /* Always show at this breakpoint */
        @include respond-min($ipad-landscape) {
          display: block;
        }
      }

      /* Non JS users */
      .no-js & {position: static;}

      /* Old IE - change the bg colour */
      @include old-ie {
        .stores-maps .stores-maps__inner.stores-maps__inner--detail & {background-color: lighten($color-grey-3, 5%);}
      }

      /* Turn off absolute positioning/overflow for 'detail view' at this breakpoint */
      @include respond-max($ipad-landscape - 1) {
        .stores-maps__inner--detail & {
          position: static;
          overflow-y: visible;
        }
      }

      /* Alter top positioning at this breakpoint */
      @include respond-min($non-palm) {
        @include to-rem(top, 66);

        /* Post filter count */
        .is-filter-applied & {@include to-rem(top, 102);}
      }

      /* Apply box treatments and alter top/btm positioning at this breakpoint */
      @include respond-min($ipad-landscape) {
        /* Temp style so current feature can be released */
        @include to-rem(top, 111);
        //@include to-rem(top, 164);
        @include to-rem(bottom, $spacing-base);
        @include box;
        @include box-heavy;

        /* Detail view */
        .stores-maps__inner--detail & {
          bottom: auto;

          /* When they're 'Featured items' */
          &.is-featured-items {
            background-color: $color-grey-3;
            @include to-rem(bottom, $spacing-base);
          }
        }

        /* Post filter count */
        .is-filter-applied & {@include to-rem(top, 200);}
      }

      /* --Store list module-- */

      /* Remove right indent for store name at this breakpoint */
      @include respond-min($ipad-landscape) {
        .stores-list__store-name {margin-right: 0;}
      }

      /* Hide location icon for 'storefront' and 'store list' modules at this breakpoint */
      @include respond-min($ipad-landscape) {
        .storefront-storelist-phone-map-links__cell--location {display:  none;}
      }
    }

      /* Category applied indicator at this breakpoint */
      .is-filter-applied .stores-list__store-name {

        @include respond-min($ipad-landscape) {
          @include to-rem(padding-left, $spacing-base+$spacing-quarter);
        }

        /* Location pin */
        .icon--pin:before {
          display: none;

          @include respond-min($ipad-landscape) {
            display: block;
            position: absolute;
            left: 0;
            @include to-rem(top, $spacing-base+$spacing-micro);
            @include to-rem(margin-top, -$spacing-sixth);
          }
        }
      }

  /* Micello map */
  .stores-maps__map {
    position: absolute;
    z-index: 3;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    display: none;

    /* When map view is in view */
    .is-map-view & {display: block;}

    /* Always show at this breakpoint */
    @include respond-min($ipad-landscape) {
      display: block;
    }

    /* Always show for old IE */
    @include old-ie {
      display: block;
    }

    /* Non JS users */
    .no-js & {position: static;}

    /* Preloader */
    @include respond-min($ipad-landscape) {
      &.map-micello .preloader {left: 75%;}
    }
  }