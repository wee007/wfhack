/* ======================================================================================
   @MODULES -> WIDGETS -> MAP MICELLO
   ====================================================================================== */

/*
  Usage:
    3rd party Map API from 'Micello'.

  Demo:
    Style Guide -> Modules -> Widgets -> Map Micello
*/

.map-micello {

  /* --Global rules-- */

  /* No bottom spacing */
  p {margin-bottom: 0;}

  /* Apply bottom spacing */
  .map-micello__mrg-base {@include to-rem(margin-bottom, $spacing-half);}

  /* Preloader */
  .preloader {
    position: absolute;
    top: 50%;
    left: 50%;
    @include translate(-50%, -50%);
  }

  /* Turn off text selection styles */
  * {@include prefix(user-select, none);}
}

/* Static version - remove all interaction and UI elements generated by 3rd party API */
.map-micello--static {
  pointer-events: none;

  #ui-zoom,
  #ui-levels,
  #ui-geo {display: none !important;}
}

  /* API container + overlay that disables all map interaction */
  .map-micello__api,
  .map-micello__disable-interaction {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
  }

    /* --Overlay-- */
    .map-micello__overlay-wrap {display: none;}

      .map-micello__overlay {
        @include to-rem(padding-top, $spacing-half+$spacing-third);

        /* Make button clickable for static view */
        .map-micello--static & .btn--main {pointer-events: auto;}
      }

        /* Header */
        .map-micello__hdr {
          @include font-size($font-size, 1.2);
          font-weight: bold;
          display: block;
        }

        /* Retailer logo and details (name + open till time) */
        .map-micello__overlay__retailer {
          position: relative;
          @include to-rem(padding-left, 95);

          /* --Make linear at these breakpoints-- */

          /* Stores & maps */
          @include respond-max($palm) {
            .stores-maps__map & {padding-left: 0;}
          }

          /* Static version */
          @include respond-range($non-palm, $ipad-portrait - 1) {
            .map-micello--static & {padding-left: 0;}
          }

          /* Remove the indent when there is no logo */
          .is-no-store-logo & {padding-left: 0;}
        }

          /* Logo */
          .map-micello__overlay__retailer__img {
            width: 84px;
            position: absolute;
            left: 0;
            top: 0;

            /* --Make linear at these breakpoints-- */

            /* Stores & maps */
            @include respond-max($palm) {
              .stores-maps__map & {
                position: static;
                @include to-rem(margin-bottom, $spacing-quarter);
                margin: 0 auto;
                width: 108px;
              }
            }

            /* Static version */
            @include respond-range($non-palm, $ipad-portrait - 1) {
              .map-micello--static & {
                position: static;
                @include to-rem(margin-bottom, $spacing-quarter);
                margin: 0 auto;
                width: 108px;
              }
            }
          }

          /* Hide the 'Store details' link at this breakpoint for the relevant store in 'Stores show' */
          .map-micello__overlay.is-active-store {
            a.map-micello__overlay__cta.btn {display: none;}

            /* Hide both the button and the link at this breakpoint */
            @include respond-min($ipad-landscape) {
              .map-micello__overlay__cta.btn  {display: none;}
            }
          }

        /* Faux close button */
        .map-micello__overlay__close {
          position: absolute;
          @include to-rem(top, 2);
          @include to-rem(right, 3);
          color: $color-light-txt;

          /* Static version */
          .map-micello--static & {display: none;}
        }

    /* --3rd party stylesheet overrides-- */

    /*
      Note: have to use `!important` here a lot as we need to override the 3rd party 'Micello' styles.
    */

    #micello-map {
      @include font-size($font-size-sml, $sledgehammer: !important);
      font-family: $font-family !important;
      line-height: 1.5 !important;

      /* Map name */
      #ui-name {display: none !important;}

      /* --Overlay-- */

      /*
        - infoOut
          - infoWrapper
            - infoBack
              - infoIn
              - infoClose
            - menuTip
      */

      /* Wrapper */
      .infoWrapper,
      .menuWrapper {
        padding-bottom: 13px !important;
        @include to-rem(margin-left, -106, !important);

        /* --Reduce the width at these breakpoints-- */

        /* Stores & maps */
        @include respond-max($palm) {
          .stores-maps__map & {@include to-rem(margin-left, -80, !important);}
        }

        /* Static version */
        @include respond-range($non-palm, $ipad-portrait - 1) {
          .map-micello--static & {@include to-rem(margin-left, -80, !important);}
        }
      }

        /* Back */
        .infoBack {
          background-color: #fff !important;
          @include to-rem(width, 252, !important);
          min-width: none !important;
          overflow: visible !important;
          margin-bottom: -14px !important;

          /* --Reduce the width at these breakpoints-- */

          /* Stores & maps */
          @include respond-max($palm) {
            .stores-maps__map & {@include to-rem(width, 200, !important);}
          }

          /* Static version */
          @include respond-range($non-palm, $ipad-portrait - 1) {
            .map-micello--static & {@include to-rem(width, 200, !important);}
          }
        }

        /* Pointer */
        .menuTip {
            background: image-url("images/map-overlay-pointer.png") no-repeat 50% 0 !important;
            @include img-2x("images/map-overlay-pointer@2x.png", 20px, 13px, !important);
            position: relative;
            top: 13px !important;
            width: 100% !important;
            height: 13px !important;
        }

          /* In */
          .infoIn {
            padding: 0 !important;
            max-width: none !important;
            max-height: none !important;
            box-shadow: 0 0 10px #ccc,
                        0 1px 1px #b4b4b4;
            border: 1px solid $color-grey-2;
          }

          /* [WIP] Close button */
          .infoClose {
            display: block !important;
            @include opacity(0, !important);
            top: 0 !important;
            right: 0 !important;
          }

      /* Floor levels */
      #ui-levels {
        #ui-levels-floors-container {background-color: transparent;}
      }

      /* Cosmetics */
      .micello-rounded {border-radius: 0;}

      .ui-shadow,
      .micello-pop-shadow {box-shadow: none !important;}
    }

/* --Old IE version-- */
@include old-ie {

  /* Make sure none of the images break out of it's container */
  .map-micello__api {overflow: hidden;}

    /* Map image */
    .map-micello-oldie__map-img {
      position: relative;
      z-index: 1;
      top: 0;
      left: 0;
    }

    /* --Controls-- */
    .map-micello-oldie__controls {
      position: absolute;
      z-index: 2;
      @include to-rem(top, 20);
      right: 0;

      /* Lists */
      ul {
        @include to-rem(margin-bottom, $spacing-base);

        /* First child to target button */
        li:first-child .btn {border-top: 1px solid $color-grey-1;}
      }

        /* Buttons */
        .btn {
          @include font-size(18, 1);
          display: block;
          background-color: #fff;
          color: $color-light-txt;
          @include to-rem(padding-top padding-bottom, $spacing-half);
          @include to-rem(width, $spacing-dbl);
          border: 1px solid $color-grey-1;
          border-top: 0;

          /* Hover and active states */
          &:hover,
          &:focus,
          &.is-active {
            background-color: $color-dark-txt;
            color: #fff;
          }
        }

        /* Zoom buttons */
        .map-micello-oldie__controls__zoom .btn {
          font-weight: bold;
          @include font-size(34, 1);
          @include to-rem(padding-top padding-bottom, $spacing-quarter);

          /* Zoom out */
          &.map-micello-oldie__controls__zoom__out {
            @include font-size(40, 0.8);
          }
        }
    }

}