<%= form_tag centre_products_path(id: params[:centre_id]), method: :get, id: 'search_form' do %>
  <%# TODO: Category select %>
  <%= hidden_field_tag "last", params[:last], class: 'last_facet' %>
  <%- params.select{|k,v| %w(category sub_category super_cat).include?(k.to_s)}.each do |key,value| -%>
    <%= hidden_field_tag key, value %>
  <%- end %>
  <%= facet_tag :retailer, @search.facets, 'Stores' %>
  <%= facet_tag :brand, @search.facets %>
  <%= facet_tag :colour, @search.facets %>
<% end %>

<div id="tiles" class="clearfix isotope">
<%- @search.products.each do |product| -%>
  <div class="tile products isotope-item" data-url="">
    <%= image_tag product.default_image_url %>
    <div class="title">
      <p class="name">
        <%=  product.lozenge_name %><br>
        <small><span>from</span> <%= product.retail_chain_name %></small>
      </p>
      <p class="price">$<%= product.display_sale_price %></p>
    </div>
  </div>
<%- end -%>

</div>

<%- content_for :javascript do -%>
  <script type='text/javascript'>
    jQuery("#search_form input, #search_form select").change(function(event) {
      var last = jQuery(event.target).attr('name');
      last = last.replace("[]","");
      jQuery("#search_form input.last_facet").val(last);
      jQuery("#search_form").submit();
    });
  </script>
<%- end -%>
